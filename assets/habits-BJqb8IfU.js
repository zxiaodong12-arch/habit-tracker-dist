import{s as _,k as h,f as v,x as c}from"./index-DDPU8cJj.js";const C=_("habits",()=>{const n=h([]),g=h(!1),u=h(!0),b=v(()=>n.value.filter(s=>!s.archived)),m=v(()=>n.value.filter(s=>s.archived));async function r(){var s,i;g.value=!0;try{const t=await c.getHabits(),a=new Map;for(const e of t){if(a.has(e.id)){console.warn("å‘ç°é‡å¤ä¹ æƒ¯ï¼Œè·³è¿‡:",e.id,e.name);continue}const l=await c.getRecords(e.id),d=c.convertHabitFromAPI(e,l);a.set(d.id,d)}n.value=Array.from(a.values())}catch(t){const a=(t==null?void 0:t.message)||((i=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:i.message)||"åŠ è½½ä¹ æƒ¯å¤±è´¥";throw console.error("åŠ è½½ä¹ æƒ¯å¤±è´¥:",a,t),t}finally{g.value=!1}}async function p(s,i){var t,a;try{await c.toggleRecord(s,i),await r()}catch(e){const l=(e==null?void 0:e.message)||((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥";throw console.error("åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥:",l,e),e}}async function w(s,i,t,a="daily",e=1,l=null){var d,f;try{await c.createHabit({name:s.trim(),emoji:i||"ğŸ“",color:t||"#10b981",archived:!1,target_type:a,target_count:e,target_start_date:l||new Date().toISOString().split("T")[0]}),await r()}catch(o){const S=(o==null?void 0:o.message)||((f=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:f.message)||"æ·»åŠ ä¹ æƒ¯å¤±è´¥";throw console.error("æ·»åŠ ä¹ æƒ¯å¤±è´¥:",S,o),o}}async function H(s,i){var t,a;try{await c.updateHabit(s,i),await r()}catch(e){const l=(e==null?void 0:e.message)||((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"æ›´æ–°ä¹ æƒ¯å¤±è´¥";throw console.error("æ›´æ–°ä¹ æƒ¯å¤±è´¥:",l,e),e}}async function y(s){var i,t;try{await c.deleteHabit(s),n.value=n.value.filter(a=>a.id!==s)}catch(a){const e=(a==null?void 0:a.message)||((t=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:t.message)||"åˆ é™¤ä¹ æƒ¯å¤±è´¥";throw console.error("åˆ é™¤ä¹ æƒ¯å¤±è´¥:",e,a),a}}async function M(s){var i,t;try{const a=n.value.find(e=>e.id===s);a&&(await c.archiveHabit(s,!a.archived),await r())}catch(a){const e=(a==null?void 0:a.message)||((t=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:t.message)||"å½’æ¡£/å–æ¶ˆå½’æ¡£å¤±è´¥";throw console.error("å½’æ¡£/å–æ¶ˆå½’æ¡£å¤±è´¥:",e,a),a}}function A(){u.value=!u.value}return{habits:n,loading:g,archivedCollapsed:u,activeHabits:b,archivedHabits:m,loadHabits:r,toggleHabit:p,addHabit:w,updateHabit:H,deleteHabit:y,toggleArchiveHabit:M,toggleArchivedCollapsed:A}});export{C as u};
