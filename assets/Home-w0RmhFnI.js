import{o as v,c as b,a as t,t as g,n as M,b as B,w as D,d as _,F as C,r as x,e as $,f as L,g as V,v as R,h as w,u as U,i as Y,j as p,k as F,l as N,m as q,p as G,q as A}from"./index-D7fGuzYZ.js";import{_ as S,u as J}from"./_plugin-vue_export-helper-iU8w_Dgc.js";function T(){const s=new Date,d=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),e=String(s.getDate()).padStart(2,"0");return`${d}-${a}-${e}`}function E(s){const d=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),e=String(s.getDate()).padStart(2,"0");return`${d}-${a}-${e}`}function O(s){const d=T();return s.records&&s.records[d]===!0}function z(s){const d=s.records||{},a=new Date;a.setHours(0,0,0,0);let e=0,r=new Date(a);for(;;){const i=E(r);if(d[i]===!0)e++,r.setDate(r.getDate()-1);else break}return e}function K(s,d=365){const a=s.records||{},e=new Date;e.setHours(0,0,0,0);const r=[];for(let i=d-1;i>=0;i--){const l=new Date(e);l.setDate(l.getDate()-i);const k=E(l);r.push({date:k,completed:a[k]===!0})}return r}function P(s){const d=s.filter(l=>!l.archived);T();const a=d.filter(l=>O(l)).length,e=d.length,r=e>0?Math.round(a/e*100):0,i=d.length>0?Math.max(...d.map(l=>z(l))):0;return{todayCompleted:a,todayTotal:e,todayRate:r,longestStreak:i}}const Q={class:"stats-bar"},W={class:"stat-item"},X={class:"stat-value"},Z={class:"stat-item"},tt={class:"stat-value"},et={class:"stat-item"},st={class:"stat-value"},at={__name:"StatsBar",props:{stats:{type:Object,required:!0}},setup(s){return(d,a)=>(v(),b("div",Q,[t("div",W,[a[0]||(a[0]=t("span",{class:"stat-label"},"ä»Šæ—¥å®Œæˆ",-1)),t("span",X,g(s.stats.todayCompleted)+"/"+g(s.stats.todayTotal),1)]),t("div",Z,[a[1]||(a[1]=t("span",{class:"stat-label"},"æ€»å®Œæˆç‡",-1)),t("span",tt,g(s.stats.todayRate)+"%",1)]),t("div",et,[a[2]||(a[2]=t("span",{class:"stat-label"},"æœ€é•¿è¿ç»­",-1)),t("span",st,g(s.stats.longestStreak)+"å¤©",1)])]))}},ot=S(at,[["__scopeId","data-v-0c89f587"]]),nt={class:"habit-header"},it={class:"habit-info"},lt={class:"habit-details"},dt={class:"habit-name"},ct={class:"habit-streak"},rt={class:"checkbox-wrapper"},ut={class:"heatmap-preview"},vt={class:"heatmap-grid"},ht=["title"],bt={__name:"HabitCard",props:{habit:{type:Object,required:!0}},emits:["toggle","click"],setup(s,{emit:d}){const a=s,e=d,r=$(()=>O(a.habit)),i=$(()=>z(a.habit)),l=$(()=>K(a.habit,56)),k=()=>{e("toggle",a.habit.id)},y=()=>{e("click",a.habit.id)};return(h,c)=>(v(),b("div",{class:_(["habit-card",{completed:r.value}]),style:M({"--habit-color":s.habit.color}),onClick:y},[t("div",nt,[t("div",it,[t("div",{class:"habit-emoji",style:M({background:`${s.habit.color}20`,color:s.habit.color})},g(s.habit.emoji||"ğŸ“"),5),t("div",lt,[t("div",dt,g(s.habit.name),1),t("div",ct,[c[0]||(c[0]=B(" è¿ç»­ ",-1)),t("strong",null,g(i.value),1),c[1]||(c[1]=B(" å¤© ",-1))])])]),t("div",rt,[t("div",{class:_(["habit-checkbox",{checked:r.value}]),onClick:D(k,["stop"])},null,2)])]),t("div",ut,[c[2]||(c[2]=t("div",{class:"heatmap-preview-title"},"æœ€è¿‘8å‘¨",-1)),t("div",vt,[(v(!0),b(C,null,x(l.value,(f,H)=>(v(),b("div",{key:H,class:_(["heatmap-day",{completed:f.completed}]),title:`${f.date}: ${f.completed?"å·²å®Œæˆ":"æœªå®Œæˆ"}`},null,10,ht))),128))])])],6))}},I=S(bt,[["__scopeId","data-v-a8399d90"]]),mt={class:"modal-content"},pt={class:"modal-header"},gt={class:"form-group"},yt={class:"form-group"},kt={class:"form-group"},ft={class:"color-picker"},_t=["onClick"],$t={class:"form-actions"},wt={type:"submit",class:"btn btn-primary"},Ct={__name:"HabitModal",props:{show:Boolean,editingHabit:Object},emits:["close","submit"],setup(s,{emit:d}){const a=s,e=d,r=["#10b981","#3b82f6","#8b5cf6","#f59e0b","#ef4444","#ec4899","#06b6d4","#84cc16"],i=w({name:"",emoji:"ğŸ“",color:"#10b981"});L(()=>a.editingHabit,y=>{y?i.value={name:y.name,emoji:y.emoji||"ğŸ“",color:y.color||"#10b981"}:i.value={name:"",emoji:"ğŸ“",color:"#10b981"}},{immediate:!0});const l=()=>{e("close")},k=()=>{e("submit",{...i.value}),l()};return(y,h)=>(v(),b("div",{class:_(["modal",{active:s.show}]),onClick:D(l,["self"])},[t("div",mt,[t("div",pt,[t("h2",null,g(s.editingHabit?"ç¼–è¾‘ä¹ æƒ¯":"æ·»åŠ æ–°ä¹ æƒ¯"),1),t("button",{class:"modal-close",onClick:l},"Ã—")]),t("form",{onSubmit:D(k,["prevent"])},[t("div",gt,[h[2]||(h[2]=t("label",{for:"habit-name"},"ä¹ æƒ¯åç§°",-1)),V(t("input",{type:"text",id:"habit-name","onUpdate:modelValue":h[0]||(h[0]=c=>i.value.name=c),required:"",autofocus:"",placeholder:"ä¾‹å¦‚ï¼šæ¯å¤©è·‘æ­¥"},null,512),[[R,i.value.name]])]),t("div",yt,[h[3]||(h[3]=t("label",{for:"habit-emoji"},"Emoji å›¾æ ‡",-1)),V(t("input",{type:"text",id:"habit-emoji","onUpdate:modelValue":h[1]||(h[1]=c=>i.value.emoji=c),maxlength:"2",placeholder:"ğŸ“"},null,512),[[R,i.value.emoji]])]),t("div",kt,[h[4]||(h[4]=t("label",{for:"habit-color"},"é¢œè‰²",-1)),t("div",ft,[(v(),b(C,null,x(r,c=>t("div",{key:c,class:_(["color-option",{active:i.value.color===c}]),style:M({background:c}),onClick:f=>i.value.color=c},null,14,_t)),64))])]),t("div",$t,[t("button",wt,g(s.editingHabit?"ä¿å­˜":"æ·»åŠ "),1),t("button",{type:"button",class:"btn btn-secondary",onClick:l},"å–æ¶ˆ")])],32)])],2))}},xt=S(Ct,[["__scopeId","data-v-43f6bd7c"]]),St={class:"container"},Ht={class:"user-bar"},jt={class:"user-info"},Mt={class:"header"},Dt={class:"section-block"},Tt={key:0,class:"habits-container"},Bt={key:1,class:"habits-container"},Vt={key:2,class:"habits-container"},Rt={class:"section-header"},Ft={class:"section-actions"},Nt={class:"section-subtitle"},qt={key:0,class:"habits-container archived-habits"},At={__name:"Home",setup(s){const d=G(),a=U(),e=J(),r=w(!1),i=w(!1),l=w(null),k=$(()=>P(e.habits));Y(async()=>{var m,o;try{await e.loadHabits()}catch(u){const n=(u==null?void 0:u.message)||((o=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:o.message)||"åŠ è½½ä¹ æƒ¯å¤±è´¥";console.error("åŠ è½½ä¹ æƒ¯å¤±è´¥:",n,u)}});const y=async m=>{var o,u;try{await e.toggleHabit(m,T())}catch(n){const j=(n==null?void 0:n.message)||((u=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:u.message)||"åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥";console.error("åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥:",j,n)}},h=m=>{l.value=e.habits.find(o=>o.id===m),i.value=!0},c=()=>{r.value=!1,i.value=!1,l.value=null},f=async m=>{var o,u;try{l.value?await e.updateHabit(l.value.id,m):await e.addHabit(m.name,m.emoji,m.color),c()}catch(n){const j=(n==null?void 0:n.message)||((u=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:u.message)||"ä¿å­˜ä¹ æƒ¯å¤±è´¥";console.error("ä¿å­˜ä¹ æƒ¯å¤±è´¥:",j,n)}},H=async()=>{await a.logout(),d.push("/login")};return(m,o)=>{var u;return v(),b("div",St,[t("div",Ht,[t("span",jt," ğŸ‘¤ æ¬¢è¿ï¼Œ"+g(((u=p(a).user)==null?void 0:u.username)||"æœªç™»å½•"),1),t("button",{class:"logout-btn",onClick:H,title:"ç™»å‡º"},[...o[2]||(o[2]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t("polyline",{points:"16 17 21 12 16 7"}),t("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)])])]),t("header",Mt,[o[3]||(o[3]=F('<h1 data-v-5da40e50>ä¹ æƒ¯è¿½è¸ªå™¨</h1><div class="app-intro" data-v-5da40e50><p class="app-intro-text" data-v-5da40e50>ä¸€ä¸ªä¸“æ³¨æ‰“å¡å’Œçœ‹åˆ°è¿›æ­¥çš„æç®€ä¹ æƒ¯è®°å½•å·¥å…·ã€‚</p><div class="app-tags" data-v-5da40e50><span class="app-tag" data-v-5da40e50>ğŸ“… æ¯æ—¥æ‰“å¡</span><span class="app-tag" data-v-5da40e50>ğŸ“ˆ è¿ç»­å¤©æ•°</span><span class="app-tag" data-v-5da40e50>ğŸ”¥ 30 å¤©çƒ­åŠ›å›¾</span><span class="app-tag" data-v-5da40e50>â˜ï¸ äº‘ç«¯å­˜å‚¨ Â· æ•°æ®å®‰å…¨</span></div></div>',2)),N(ot,{stats:k.value},null,8,["stats"])]),t("main",null,[t("section",Dt,[o[6]||(o[6]=t("div",{class:"section-header"},[t("h2",{class:"section-title"},"æ­£åœ¨è¿›è¡Œçš„ä¹ æƒ¯")],-1)),p(e).loading?(v(),b("div",Tt,[...o[4]||(o[4]=[t("div",{class:"loading"},"åŠ è½½ä¸­...",-1)])])):p(e).activeHabits.length===0?(v(),b("div",Bt,[...o[5]||(o[5]=[F('<div class="empty-state" data-v-5da40e50><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-5da40e50><circle cx="12" cy="12" r="10" data-v-5da40e50></circle><line x1="12" y1="8" x2="12" y2="12" data-v-5da40e50></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-5da40e50></line></svg><h3 data-v-5da40e50>è¿˜æ²¡æœ‰ä¹ æƒ¯</h3><p data-v-5da40e50>ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯</p></div>',1)])])):(v(),b("div",Vt,[(v(!0),b(C,null,x(p(e).activeHabits,n=>(v(),A(I,{key:n.id,habit:n,onToggle:y,onClick:h},null,8,["habit"]))),128))]))]),p(e).archivedHabits.length>0?(v(),b("section",{key:0,class:_(["section-block archived-section",{collapsed:p(e).archivedCollapsed}])},[t("div",Rt,[o[7]||(o[7]=t("h2",{class:"section-title"},"å·²å½’æ¡£çš„ä¹ æƒ¯",-1)),t("div",Ft,[t("span",Nt,g(p(e).archivedHabits.length)+" ä¸ª",1),t("button",{class:"section-toggle-btn",onClick:o[0]||(o[0]=(...n)=>p(e).toggleArchivedCollapsed&&p(e).toggleArchivedCollapsed(...n))},g(p(e).archivedCollapsed?"å±•å¼€":"æ”¶èµ·"),1)])]),p(e).archivedCollapsed?q("",!0):(v(),b("div",qt,[(v(!0),b(C,null,x(p(e).archivedHabits,n=>(v(),A(I,{key:n.id,habit:n,onToggle:y,onClick:h},null,8,["habit"]))),128))]))],2)):q("",!0)]),t("button",{class:"fab",onClick:o[1]||(o[1]=n=>r.value=!0),title:"æ·»åŠ æ–°ä¹ æƒ¯"},[...o[8]||(o[8]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])]),N(xt,{show:r.value||i.value,"editing-habit":l.value,onClose:c,onSubmit:f},null,8,["show","editing-habit"])])}}},Ot=S(At,[["__scopeId","data-v-5da40e50"]]);export{Ot as default};
