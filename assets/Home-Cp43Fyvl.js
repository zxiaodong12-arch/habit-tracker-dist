import{o as h,c as b,a as t,t as v,b as $,d as H,n as D,w as I,e as S,F as B,r as P,f as w,u as q,g as z,h as y,i as A,j as R,k as T,l as Y,m as F}from"./index-BDVJ00ah.js";import{u as G}from"./habits-6yD0-hm_.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{H as J}from"./HabitModal-DPvlC_n3.js";function N(){const e=new Date,i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${i}-${a}-${s}`}function L(e){const i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${i}-${a}-${s}`}function O(e){const i=N();return e.records&&e.records[i]===!0}function K(e){const i=e.records||{},a=new Date;a.setHours(0,0,0,0);let s=0,d=new Date(a);for(;;){const u=L(d);if(i[u]===!0)s++,d.setDate(d.getDate()-1);else break}return s}function Q(e,i=365){const a=e.records||{},s=new Date;s.setHours(0,0,0,0);const d=[];for(let u=i-1;u>=0;u--){const r=new Date(s);r.setDate(r.getDate()-u);const g=L(r);d.push({date:g,completed:a[g]===!0})}return d}function E(e){const i=e.records||{},a=Object.keys(i).filter(r=>i[r]===!0).sort();if(a.length===0)return 0;let s=1,d=1;const u=1e3*60*60*24;for(let r=1;r<a.length;r++){const g=new Date(a[r-1]),m=new Date(a[r]);g.setHours(0,0,0,0),m.setHours(0,0,0,0),Math.round((m-g)/u)===1?d++:(s=Math.max(s,d),d=1)}return Math.max(s,d)}function U(e){const i=e.filter(g=>!g.archived);N();const a=i.filter(g=>O(g)).length,s=i.length,d=s>0?Math.round(a/s*100):0;let u=0,r="";return i.length>0&&i.forEach(g=>{const m=E(g);m>u&&(u=m,r=g.name||"")}),{todayCompleted:a,todayTotal:s,todayRate:d,longestStreak:u,longestStreakHabitName:r}}const W={class:"stats-bar"},X={class:"stat-item"},Z={class:"stat-value"},tt={class:"stat-item"},et={class:"stat-value"},st={class:"stat-item"},at={class:"stat-value"},ot={key:0},nt={__name:"StatsBar",props:{stats:{type:Object,required:!0}},setup(e){return(i,a)=>(h(),b("div",W,[t("div",X,[a[0]||(a[0]=t("span",{class:"stat-label"},"ä»Šæ—¥å®Œæˆ",-1)),t("span",Z,v(e.stats.todayCompleted)+"/"+v(e.stats.todayTotal),1)]),t("div",tt,[a[1]||(a[1]=t("span",{class:"stat-label"},"æ€»å®Œæˆç‡",-1)),t("span",et,v(e.stats.todayRate)+"%",1)]),t("div",st,[a[2]||(a[2]=t("span",{class:"stat-label"},"ğŸ”¥ å†å²æœ€é•¿è¿ç»­å¤©æ•°",-1)),t("span",at,[$(v(e.stats.longestStreak)+"å¤© ",1),e.stats.longestStreakHabitName?(h(),b("span",ot,"Â· "+v(e.stats.longestStreakHabitName),1)):H("",!0)])])]))}},lt=j(nt,[["__scopeId","data-v-3f7af0d9"]]),it={class:"habit-header"},rt={class:"habit-info"},ct={class:"habit-details"},dt={class:"habit-name"},ut={class:"habit-streak"},gt={key:0,class:"habit-target-progress"},ht={class:"target-label"},vt={class:"target-value"},pt={class:"target-progress-bar"},bt={class:"checkbox-wrapper"},yt={class:"heatmap-preview"},mt={class:"heatmap-grid"},kt=["title"],ft={__name:"HabitCard",props:{habit:{type:Object,required:!0},targetProgress:{type:Object,default:null}},emits:["toggle","click"],setup(e,{emit:i}){const a=e,s=i,d=w(()=>O(a.habit)),u=w(()=>K(a.habit)),r=w(()=>Q(a.habit,30)),g=w(()=>E(a.habit)),m=()=>a.targetProgress&&{daily:"æœ¬å‘¨",weekly:"æœ¬å‘¨",monthly:"æœ¬æœˆ",yearly:"ä»Šå¹´"}[a.targetProgress.target_type]||"",k=()=>{s("toggle",a.habit.id)},f=()=>{s("click",a.habit.id)};return(C,p)=>(h(),b("div",{class:S(["habit-card",{completed:d.value}]),style:D({"--habit-color":e.habit.color}),onClick:f},[t("div",it,[t("div",rt,[t("div",{class:"habit-emoji",style:D({background:`${e.habit.color}20`,color:e.habit.color})},v(e.habit.emoji||"ğŸ“"),5),t("div",ct,[t("div",dt,v(e.habit.name),1),t("div",ut,[t("span",null,[p[0]||(p[0]=$("å½“å‰è¿ç»­ ",-1)),t("strong",null,v(u.value),1),p[1]||(p[1]=$(" å¤©",-1))]),p[4]||(p[4]=t("span",{class:"streak-divider"},"Â·",-1)),t("span",null,[p[2]||(p[2]=$("ğŸ”¥ å†å²æœ€é•¿ ",-1)),t("strong",null,v(g.value),1),p[3]||(p[3]=$(" å¤©",-1))])]),e.targetProgress?(h(),b("div",gt,[t("span",ht,v(m())+"è¿›åº¦:",1),t("span",vt,v(e.targetProgress.completed)+"/"+v(e.targetProgress.target_count),1),t("div",pt,[t("div",{class:"target-progress-fill",style:D({width:`${e.targetProgress.progress}%`,backgroundColor:e.habit.color})},null,4)])])):H("",!0)])]),t("div",bt,[t("div",{class:S(["habit-checkbox",{checked:d.value}]),onClick:I(k,["stop"])},null,2)])]),t("div",yt,[p[5]||(p[5]=t("div",{class:"heatmap-preview-title"},"æœ€è¿‘30å¤©",-1)),t("div",mt,[(h(!0),b(B,null,P(r.value,(_,x)=>(h(),b("div",{key:x,class:S(["heatmap-day",{completed:_.completed}]),title:`${_.date}: ${_.completed?"å·²å®Œæˆ":"æœªå®Œæˆ"}`},null,10,kt))),128))])])],6))}},V=j(ft,[["__scopeId","data-v-504bb44a"]]),_t={class:"container"},$t={class:"user-bar"},wt={class:"user-info"},St={class:"header"},Ht={class:"section-block"},Ct={key:0,class:"habits-container"},xt={key:1,class:"habits-container"},Mt={key:2,class:"habits-container"},Dt={class:"section-header"},Tt={class:"section-actions"},Bt={class:"section-subtitle"},Pt={key:0,class:"habits-container archived-habits"},jt={__name:"Home",setup(e){const i=Y(),a=q(),s=G(),d=T(!1),u=T(!1),r=T(null),g=w(()=>U(s.habits));z(async()=>{var c,o;try{await s.loadHabits()}catch(l){const n=(l==null?void 0:l.message)||((o=(c=l==null?void 0:l.response)==null?void 0:c.data)==null?void 0:o.message)||"åŠ è½½ä¹ æƒ¯å¤±è´¥";console.error("åŠ è½½ä¹ æƒ¯å¤±è´¥:",n,l)}});const m=async c=>{var o,l;try{await s.toggleHabit(c,N())}catch(n){const M=(n==null?void 0:n.message)||((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥";console.error("åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥:",M,n)}},k=c=>{i.push(`/habit/${c}`)},f=()=>{d.value=!1,u.value=!1,r.value=null},C=async c=>{var o,l;try{r.value?await s.updateHabit(r.value.id,c):await s.addHabit(c.name,c.emoji,c.color,c.target_type||"daily",c.target_count||1,c.target_start_date),f()}catch(n){const M=(n==null?void 0:n.message)||((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"ä¿å­˜ä¹ æƒ¯å¤±è´¥";console.error("ä¿å­˜ä¹ æƒ¯å¤±è´¥:",M,n)}},p=async()=>{var c,o;if(r.value)try{await s.toggleArchiveHabit(r.value.id),f()}catch(l){const n=(l==null?void 0:l.message)||((o=(c=l==null?void 0:l.response)==null?void 0:c.data)==null?void 0:o.message)||"å½’æ¡£æ“ä½œå¤±è´¥";console.error("å½’æ¡£æ“ä½œå¤±è´¥:",n,l)}},_=async()=>{await a.logout(),i.push("/login")},x=c=>(!c.target_type||!c.target_count,null);return(c,o)=>{var l;return h(),b("div",_t,[t("div",$t,[t("span",wt," ğŸ‘¤ æ¬¢è¿ï¼Œ"+v(((l=y(a).user)==null?void 0:l.username)||"æœªç™»å½•"),1),t("button",{class:"logout-btn",onClick:_,title:"ç™»å‡º"},[...o[2]||(o[2]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t("polyline",{points:"16 17 21 12 16 7"}),t("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)])])]),t("header",St,[o[3]||(o[3]=A('<h1 data-v-95765887>ä¹ æƒ¯è¿½è¸ªå™¨</h1><div class="app-intro" data-v-95765887><p class="app-intro-text" data-v-95765887>ä¸€ä¸ªä¸“æ³¨æ‰“å¡å’Œçœ‹åˆ°è¿›æ­¥çš„æç®€ä¹ æƒ¯è®°å½•å·¥å…·ã€‚</p><div class="app-tags" data-v-95765887><span class="app-tag" data-v-95765887>ğŸ“… æ¯æ—¥æ‰“å¡</span><span class="app-tag" data-v-95765887>ğŸ“ˆ è¿ç»­å¤©æ•°</span><span class="app-tag" data-v-95765887>ğŸ”¥ 30 å¤©çƒ­åŠ›å›¾</span><span class="app-tag" data-v-95765887>â˜ï¸ äº‘ç«¯å­˜å‚¨ Â· æ•°æ®å®‰å…¨</span></div></div>',2)),R(lt,{stats:g.value},null,8,["stats"])]),t("main",null,[t("section",Ht,[o[6]||(o[6]=t("div",{class:"section-header"},[t("h2",{class:"section-title"},"æ­£åœ¨è¿›è¡Œçš„ä¹ æƒ¯")],-1)),y(s).loading?(h(),b("div",Ct,[...o[4]||(o[4]=[t("div",{class:"loading"},"åŠ è½½ä¸­...",-1)])])):y(s).activeHabits.length===0?(h(),b("div",xt,[...o[5]||(o[5]=[A('<div class="empty-state" data-v-95765887><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-95765887><circle cx="12" cy="12" r="10" data-v-95765887></circle><line x1="12" y1="8" x2="12" y2="12" data-v-95765887></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-95765887></line></svg><h3 data-v-95765887>è¿˜æ²¡æœ‰ä¹ æƒ¯</h3><p data-v-95765887>ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯</p></div>',1)])])):(h(),b("div",Mt,[(h(!0),b(B,null,P(y(s).activeHabits,n=>(h(),F(V,{key:n.id,habit:n,"target-progress":x(n),onToggle:m,onClick:k},null,8,["habit","target-progress"]))),128))]))]),y(s).archivedHabits.length>0?(h(),b("section",{key:0,class:S(["section-block archived-section",{collapsed:y(s).archivedCollapsed}])},[t("div",Dt,[o[7]||(o[7]=t("h2",{class:"section-title"},"å·²å½’æ¡£çš„ä¹ æƒ¯",-1)),t("div",Tt,[t("span",Bt,v(y(s).archivedHabits.length)+" ä¸ª",1),t("button",{class:"section-toggle-btn",onClick:o[0]||(o[0]=(...n)=>y(s).toggleArchivedCollapsed&&y(s).toggleArchivedCollapsed(...n))},v(y(s).archivedCollapsed?"å±•å¼€":"æ”¶èµ·"),1)])]),y(s).archivedCollapsed?H("",!0):(h(),b("div",Pt,[(h(!0),b(B,null,P(y(s).archivedHabits,n=>(h(),F(V,{key:n.id,habit:n,onToggle:m,onClick:k},null,8,["habit"]))),128))]))],2)):H("",!0)]),t("button",{class:"fab",onClick:o[1]||(o[1]=n=>d.value=!0),title:"æ·»åŠ æ–°ä¹ æƒ¯"},[...o[8]||(o[8]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])]),R(J,{show:d.value||u.value,"editing-habit":r.value,onClose:f,onSubmit:C,onArchive:p},null,8,["show","editing-habit"])])}}},Vt=j(jt,[["__scopeId","data-v-95765887"]]);export{Vt as default};
